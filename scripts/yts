#!/bin/bash
# YouTube Search with interactive selection

if [[ -z "$1" ]]; then
    echo "Usage: yts <search query>"
    exit 1
fi

echo "üîç Searching YouTube for: $*"
echo ""

# Get search results
results=$(yt-dlp "ytsearch10:$*" --get-title --get-id --flat-playlist 2>/dev/null)

if [[ -z "$results" ]]; then
    echo "‚ùå No results found or yt-dlp not installed"
    echo "Install: sudo pacman -S yt-dlp"
    exit 1
fi

# Parse and display results
declare -a titles
declare -a ids
i=1

while IFS= read -r line; do
    if (( i % 2 == 1 )); then
        titles+=("$line")
    else
        ids+=("$line")
    fi
    ((i++))
done <<< "$results"

# Display menu
echo "Select a video:"
for i in "${!titles[@]}"; do
    echo "  $((i+1)). ${titles[$i]}"
done
echo ""
echo -n "Enter number (1-${#titles[@]}) or 'q' to quit: "
read -r choice

if [[ "$choice" == "q" ]]; then
    exit 0
fi

if [[ "$choice" =~ ^[0-9]+$ ]] && (( choice >= 1 && choice <= ${#titles[@]} )); then
    idx=$((choice - 1))
    echo "‚ñ∂Ô∏è  Playing: ${titles[$idx]}"
    mpv "https://youtube.com/watch?v=${ids[$idx]}"
else
    echo "‚ùå Invalid selection"
fi
