#!/bin/bash
# Manual ncspot auth helper

# Start ncspot in background and capture output
ncspot 2>&1 | tee /tmp/ncspot-auth.log &
NCSPOT_PID=$!

echo "â³ Waiting for authorization URL..."
sleep 3

# Extract and open the URL
AUTH_URL=$(grep "Browse to:" /tmp/ncspot-auth.log | sed 's/.*Browse to: //')

if [[ -n "$AUTH_URL" ]]; then
    echo "ðŸŒ Opening browser..."
    xdg-open "$AUTH_URL" 2>/dev/null || {
        echo ""
        echo "ðŸ“‹ Copy this URL to your browser:"
        echo "$AUTH_URL"
    }
    
    echo ""
    echo "âœ… After authorizing in browser, ncspot will start automatically!"
    echo "âŒ¨ï¸  Press Ctrl+C to cancel if needed"
    
    # Bring ncspot to foreground
    fg
else
    echo "âŒ Couldn't find auth URL. Try running 'ncspot' directly."
    kill $NCSPOT_PID 2>/dev/null
fi
